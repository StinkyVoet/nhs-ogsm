@page "/OgsmItem"
@using nhs_ogsm.Data
@using nhs_ogsm.Services
@using Microsoft.AspNetCore.Http.Extensions
@inject OgsmItemService OgsmItemService;

<h3>@pageTitle</h3>

<EditForm Model="@_ogsm" OnValidSubmit="HandleSubmit">
    <label for="TitleInput">Title</label>
    <InputText id="TitleInput" @bind-Value="@_ogsm.Title"></InputText>
    
    <button type="submit" class="btn-primary">Save</button>
</EditForm>

@code
{
    public string pageTitle = "New ogsm item";
}

<table class="table">
    <thead>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Delete</th>
        <th>Edit</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var ogsmItems in _ogsmItemsArray)
    {
        <tr>
            <td>@ogsmItems.ID</td>
            <td>@ogsmItems.Title</td>
            <td><input type="button" value="Delete" onclick="@(() => HandleDelete(ogsmItems))" class="btn btn-default"/></td>
            <td><input type="button" value="Edit" onclick="@(() => EditForm(ogsmItems))" class="btn btn-default"/></td>
        </tr>
    }
    </tbody>
</table>



@code
{
    public List<Ogsm> _ogsmItemsArray;
    private bool isEdit = false;
    
    //Save new OGSM item
    Ogsm _ogsm = new();
    public void HandleSubmit(EditContext editContext)
    {
        var newOgsmItem = (Ogsm)editContext.Model;
        if (isEdit)
        {
            OgsmItemService.UpdateOgsm(_ogsm);
        }
        else
        {
            OgsmItemService.AddOgsm(newOgsmItem);
        }
        _ogsm = new Ogsm();
        _ogsmItemsArray = OgsmItemService.GetAllOgsm();
        StateHasChanged();
    }
    
    //Save new OGSM item
    public void HandleDelete(Ogsm item)
    {
        OgsmItemService.DeleteOgsm(item.ID);
        _ogsmItemsArray.Remove(item);
        StateHasChanged();
    }

    public void EditForm(Ogsm item)
    {
        isEdit = true;
        pageTitle = "Editing: "+item.ID;
        _ogsm = item;
        StateHasChanged();
    }
    
    //get Ogsm items on load
    protected override async Task OnInitializedAsync()
    {
        _ogsmItemsArray = OgsmItemService.GetAllOgsm();
    }
    
}